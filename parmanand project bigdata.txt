-- Create a Hive table to load the CSV data
CREATE TABLE taxi_trips (
    vendor_id STRING,
    pickup_datetime STRING,
    dropoff_datetime STRING,
    passenger_count INT,
    trip_distance DECIMAL(9,6),
    pickup_longitude DECIMAL(9,6),
    pickup_latitude DECIMAL(9,6),
    rate_code INT,
    store_and_fwd_flag STRING,
    dropoff_longitude DECIMAL(9,6),
    dropoff_latitude DECIMAL(9,6),
    payment_type STRING,
    fare_amount DECIMAL(9,6),
    extra DECIMAL(9,6),
    mta_tax DECIMAL(9,6),
    tip_amount DECIMAL(9,6),
    tolls_amount DECIMAL(9,6),
    total_amount DECIMAL(9,6),
    trip_time_in_secs INT
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE
LOCATION '/your/hdfs/location'; -- Replace this with the actual HDFS location of your CSV file

-- Load data into the Hive table
LOAD DATA INPATH '/your/local/location/2018_Yellow_Taxi_Trip_Data.csv' INTO TABLE taxi_trips;

-- Now, you can write HiveQL queries to answer each of the questions:

-- 1. Total Number of trips
SELECT COUNT(*) AS total_trips FROM taxi_trips;

-- 2. Total revenue generated by all the trips
SELECT SUM(total_amount) AS total_revenue FROM taxi_trips;

-- 3. Fraction of the total paid for tolls
SELECT SUM(tolls_amount) / SUM(total_amount) AS tolls_fraction FROM taxi_trips;

-- 4. Fraction of the total paid for driver tips
SELECT SUM(tip_amount) / SUM(total_amount) AS tips_fraction FROM taxi_trips;

-- 5. Average trip amount
SELECT AVG(total_amount) AS avg_trip_amount FROM taxi_trips;

-- 6. Average distance of the trips
SELECT AVG(trip_distance) AS avg_trip_distance FROM taxi_trips;

-- 7. Number of different payment types used
SELECT COUNT(DISTINCT payment_type) AS num_payment_types FROM taxi_trips;

-- 8. For each payment type, display average fare, average tip, and average tax
SELECT 
    payment_type,
    AVG(fare_amount) AS avg_fare,
    AVG(tip_amount) AS avg_tip,
    AVG(mta_tax) AS avg_tax
FROM taxi_trips
GROUP BY payment_type;

-- 9. On average which hour of the day generates the highest revenue
SELECT 
    HOUR(pickup_datetime) AS pickup_hour,
    SUM(total_amount) AS total_revenue
FROM taxi_trips
GROUP BY HOUR(pickup_datetime)
ORDER BY total_revenue DESC
LIMIT 1;
